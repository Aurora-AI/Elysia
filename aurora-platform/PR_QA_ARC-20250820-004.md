### ✅ QA — ARC-20250820-004 · HRM: Operadores & Prioridade

**Escopo verificado**

* Suporte a operadores no `when`: `eq`, `ne`, `gt`, `gte`, `lt`, `lte`, `in`, `nin`, `regex`, `startswith`, `endswith`, `contains`.
* Campo `priority` por regra (ordem desc) + política **“vence por chave”** (primeira regra que definir uma chave impede sobrescrita por regras subsequentes).

**Resultados**

* [x] Testes unitários/integração: `make test-all` **PASS** (11 testes)
* [x] Router `/healthz`: **200** `{ "ok": true }`
* [x] Router `/capabilities`: inclui `hrm.evaluate`
* [x] Smoke HRM — **Caso 1 (prioridade)**
  Fatos: `{"tribunal":"TRT","classe":"Recurso Ordinário","assunto":"Execução","valor_causa":15000}`
  **Esperado:** `matched_rules[0] == "prazo_recurso_trt"` e, nas decisões, `prazo_dias: 8`, `base_legal: "CLT art. 895"`; nenhuma regra posterior sobrescreve essas chaves.
  **Observado:** ✔ conforme esperado.
* [x] Smoke HRM — **Caso 2 (fallback sem sobrescrever)**
  Fatos: `{"tribunal":"TRT","classe":"Outro","assunto":"Fase de Execução"}`
  **Esperado:** presença de decisões não conflitantes (ex.: `observacao`/`flag_prosseguir`) e ausência de sobrescrita de chaves já definidas.
  **Observado:** ✔ decisões retornadas (ex.: `observacao: "Aplicar rito trabalhista"`, `prazo_dias: 0`, `base_legal: "Procedimento local"`), sem sobrescrita indevida.

**Evidência (smoke)**

* Comentário com saídas: https://github.com/Aurora-AI/Aurora-Plataform/pull/50#issuecomment-3210899149
  Arquivo: `smoke_hrm_ops.txt` (inclui `/healthz`, `/capabilities`, `hrm.evaluate` caso 1 e 2)

**Notas**

* Regras antigas com `when: campo: valor` permanecem compatíveis (tratadas como `eq`).
* Operadores numéricos convertem strings tipo `"10,5"` → `10.5`; entradas não numéricas **não** passam nos comparativos.
* `contains` aceita string (substring) **ou** lista (todos os itens devem existir).

**Status final:** ✅ **Aprovado no QA funcional** (testes + smoke)

<details>
  <summary>Como reproduzir localmente (resumo)</summary>

```bash
cd aurora-platform
source .venv/bin/activate 2>/dev/null || . .venv/Scripts/activate
PYTHONPATH=. uvicorn src.router.router_service:app --host 0.0.0.0 --port 8090 --workers 1 &
sleep 2

# Caso 1 — prioridade
curl -sS -X POST http://localhost:8090/invoke \
  -H 'Content-Type: application/json' \
  -d '{"capability_id":"hrm.evaluate","payload":{"facts":{"tribunal":"TRT","classe":"Recurso Ordinário","assunto":"Execução","valor_causa":15000}},"timeout_ms":2000}' | jq

# Caso 2 — fallback
curl -sS -X POST http://localhost:8090/invoke \
  -H 'Content-Type: application/json' \
  -d '{"capability_id":"hrm.evaluate","payload":{"facts":{"tribunal":"TRT","classe":"Outro","assunto":"Fase de Execução"}},"timeout_ms":2000}' | jq
```

</details>
