# ARC-20250820-002 — HRM (Motor de Regras) • Integração via Router

## Resumo
Integra o HRM ao ecossistema Aurora via Router `/invoke` com a capability `hrm.evaluate`:
- Engine determinística com matching por igualdade e justificativas por regra.
- RuleSet YAML versionado (sample incluído).
- Testes E2E do `/invoke` (sem dependências externas).
- Makefile com alvos de teste dedicados.

## Mudanças principais
- `src/hrm/engine.py`: avaliação de regras e geração de explicações.
- `src/router/capabilities_registry.yaml`: adiciona `hrm.evaluate` (transport `internal_python`).
- `.env.example`: adiciona `HRM_DEFAULT_RULESET`.
- `tests/test_hrm_invoke.py`: E2E do `/invoke` para HRM.
- `Makefile`: adiciona `test-hrm` e `test-all`.

## Como testar
```bash
cd aurora-platform
python -m venv .venv && source .venv/bin/activate
make install
make test-hrm
make test-all
```

Opcional (smoke via Router):

```bash
PYTHONPATH=. uvicorn src.router.router_service:app --host 0.0.0.0 --port 8090 --workers 1 &
sleep 2
curl -sS -X POST "http://localhost:8090/invoke" \
  -H "Content-Type: application/json" \
  -d '{"capability_id":"hrm.evaluate","payload":{"facts":{"tribunal":"TRT","classe":"Recurso"}},"timeout_ms":2000}'
```

## Evidências (substituir pelos seus)

* `pytest`: **passed** para `test_hrm_invoke.py` e `test-all`.
* `/invoke hrm.evaluate` → `status: ok`, `matched_rules` contém a regra do sample, `decisions` com `prazo_dias`/`base_legal`.

## Próximos passos

* Estender operadores de matching (>, <, in, regex).
* Prioridade e resolução de conflitos.
* Encadeamento Memória → HRM (fatos derivados do RAG).
